{"ast":null,"code":"\"use strict\";\n/**\n * @fileoverview SIP URI\n */\n\n/**\n * @augments SIP\n * @class Class creating a SIP URI.\n *\n * @param {String} [scheme]\n * @param {String} [user]\n * @param {String} host\n * @param {String} [port]\n * @param {Object} [parameters]\n * @param {Object} [headers]\n *\n */\n\nmodule.exports = function (SIP) {\n  var URI;\n\n  URI = function URI(scheme, user, host, port, parameters, headers) {\n    var param, header, raw, normal; // Checks\n\n    if (!host) {\n      throw new TypeError('missing or invalid \"host\" parameter');\n    } // Initialize parameters\n\n\n    scheme = scheme || SIP.C.SIP;\n    this.parameters = {};\n    this.headers = {};\n\n    for (param in parameters) {\n      this.setParam(param, parameters[param]);\n    }\n\n    for (header in headers) {\n      this.setHeader(header, headers[header]);\n    } // Raw URI\n\n\n    raw = {\n      scheme: scheme,\n      user: user,\n      host: host,\n      port: port\n    }; // Normalized URI\n\n    normal = {\n      scheme: scheme.toLowerCase(),\n      user: user,\n      host: host.toLowerCase(),\n      port: port\n    };\n    Object.defineProperties(this, {\n      _normal: {\n        get: function get() {\n          return normal;\n        }\n      },\n      _raw: {\n        get: function get() {\n          return raw;\n        }\n      },\n      scheme: {\n        get: function get() {\n          return normal.scheme;\n        },\n        set: function set(value) {\n          raw.scheme = value;\n          normal.scheme = value.toLowerCase();\n        }\n      },\n      user: {\n        get: function get() {\n          return normal.user;\n        },\n        set: function set(value) {\n          normal.user = raw.user = value;\n        }\n      },\n      host: {\n        get: function get() {\n          return normal.host;\n        },\n        set: function set(value) {\n          raw.host = value;\n          normal.host = value.toLowerCase();\n        }\n      },\n      aor: {\n        get: function get() {\n          return normal.user + '@' + normal.host;\n        }\n      },\n      port: {\n        get: function get() {\n          return normal.port;\n        },\n        set: function set(value) {\n          normal.port = raw.port = value === 0 ? value : parseInt(value, 10) || null;\n        }\n      }\n    });\n  };\n\n  URI.prototype = {\n    setParam: function setParam(key, value) {\n      if (key) {\n        this.parameters[key.toLowerCase()] = typeof value === 'undefined' || value === null ? null : value.toString().toLowerCase();\n      }\n    },\n    getParam: function getParam(key) {\n      if (key) {\n        return this.parameters[key.toLowerCase()];\n      }\n    },\n    hasParam: function hasParam(key) {\n      if (key) {\n        return this.parameters.hasOwnProperty(key.toLowerCase()) && true || false;\n      }\n    },\n    deleteParam: function deleteParam(parameter) {\n      var value;\n      parameter = parameter.toLowerCase();\n\n      if (this.parameters.hasOwnProperty(parameter)) {\n        value = this.parameters[parameter];\n        delete this.parameters[parameter];\n        return value;\n      }\n    },\n    clearParams: function clearParams() {\n      this.parameters = {};\n    },\n    setHeader: function setHeader(name, value) {\n      this.headers[SIP.Utils.headerize(name)] = value instanceof Array ? value : [value];\n    },\n    getHeader: function getHeader(name) {\n      if (name) {\n        return this.headers[SIP.Utils.headerize(name)];\n      }\n    },\n    hasHeader: function hasHeader(name) {\n      if (name) {\n        return this.headers.hasOwnProperty(SIP.Utils.headerize(name)) && true || false;\n      }\n    },\n    deleteHeader: function deleteHeader(header) {\n      var value;\n      header = SIP.Utils.headerize(header);\n\n      if (this.headers.hasOwnProperty(header)) {\n        value = this.headers[header];\n        delete this.headers[header];\n        return value;\n      }\n    },\n    clearHeaders: function clearHeaders() {\n      this.headers = {};\n    },\n    clone: function clone() {\n      return new URI(this._raw.scheme, this._raw.user, this._raw.host, this._raw.port, JSON.parse(JSON.stringify(this.parameters)), JSON.parse(JSON.stringify(this.headers)));\n    },\n    toRaw: function toRaw() {\n      return this._toString(this._raw);\n    },\n    toString: function toString() {\n      return this._toString(this._normal);\n    },\n    _toString: function _toString(uri) {\n      var header,\n          parameter,\n          idx,\n          uriString,\n          headers = [];\n      uriString = uri.scheme + ':'; // add slashes if it's not a sip(s) URI\n\n      if (!uri.scheme.toLowerCase().match(\"^sips?$\")) {\n        uriString += \"//\";\n      }\n\n      if (uri.user) {\n        uriString += SIP.Utils.escapeUser(uri.user) + '@';\n      }\n\n      uriString += uri.host;\n\n      if (uri.port || uri.port === 0) {\n        uriString += ':' + uri.port;\n      }\n\n      for (parameter in this.parameters) {\n        uriString += ';' + parameter;\n\n        if (this.parameters[parameter] !== null) {\n          uriString += '=' + this.parameters[parameter];\n        }\n      }\n\n      for (header in this.headers) {\n        for (idx in this.headers[header]) {\n          headers.push(header + '=' + this.headers[header][idx]);\n        }\n      }\n\n      if (headers.length > 0) {\n        uriString += '?' + headers.join('&');\n      }\n\n      return uriString;\n    }\n  };\n  /**\n    * Parse the given string and returns a SIP.URI instance or undefined if\n    * it is an invalid URI.\n    * @public\n    * @param {String} uri\n    */\n\n  URI.parse = function (uri) {\n    uri = SIP.Grammar.parse(uri, 'SIP_URI');\n\n    if (uri !== -1) {\n      return uri;\n    } else {\n      return undefined;\n    }\n  };\n\n  SIP.URI = URI;\n};","map":null,"metadata":{},"sourceType":"script"}